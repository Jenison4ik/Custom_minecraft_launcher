# Решения проблемы "курицы и яйца" с SSL сертификатами

## Проблема

При первом запуске nginx требует SSL сертификаты, но certbot может их получить только когда nginx уже работает и обслуживает challenge-запросы.

## ✅ Условная конфигурация

### Как это работает:

1. Entrypoint скрипт проверяет наличие сертификатов
2. Если сертификатов нет - использует `nginx-init.conf.template` (без HTTPS, только HTTP на порту 80)
3. Если сертификаты есть - использует `nginx.conf.template` (полная конфигурация с HTTPS)

### Процесс первого запуска:

```bash
# 1. Запустите nginx и app (nginx запустится без HTTPS)
docker-compose up -d nginx app

# 2. Получите сертификаты через certbot-init
docker-compose --profile init run --rm certbot-init

# 3. Перезагрузите nginx (он автоматически переключится на HTTPS конфигурацию)
docker exec nginx_proxy nginx -s reload
```

### Автоматическое переключение при перезапуске:

После получения сертификатов, при следующем перезапуске контейнера nginx автоматически обнаружит сертификаты и переключится на HTTPS конфигурацию.

---
